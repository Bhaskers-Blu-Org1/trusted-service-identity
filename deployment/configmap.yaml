apiVersion: v1
kind: ConfigMap
metadata:
  name: sidecar-injector-webhook-configmap
data:
  sidecarconfig.yaml: |
    containers:
      - name: sidecar-nginx
        image: nginx:1.12.2
        imagePullPolicy: IfNotPresent
        ports:
          - containerPort: 80
        volumeMounts:
          - name: nginx-conf
            mountPath: /etc/nginx
    volumes:
      - name: nginx-conf
        configMap:
          name: nginx-configmap
    initcontainerconfig.yaml: |
        initContainers:
        - name: gen-vault-cert
          image: lumjjb/gen-vault-cert:v1
          imagePullPolicy: IfNotPresent
          volumeMounts:
            - name: ti-vault-secret
              mountPath: /vault-certs
        volumes:
          - name: ti-vault-secret
            secret:
              secretName: ti-secret-changeme
        addVolumeMounts:
          - name: ti-vault-secret
            mountPath: /vault-certs

