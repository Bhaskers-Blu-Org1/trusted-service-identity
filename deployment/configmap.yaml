apiVersion: v1
kind: ConfigMap
metadata:
  name: sidecar-injector-webhook-configmap
data:
  initcontainerconfig.yaml: |
      initContainers:
      - name: gen-vault-cert
        image: lumjjb/gen-vault-cert:v1
        imagePullPolicy: Always
        volumeMounts:
          - name: pod-metadata
            mountPath: /pod-metadata
          - name: pod-identity
            mountPath: /pod-identity
      volumes:
        - name: pod-metadata
          downwardAPI:
            items:
              - path: "ti-secret"
                fieldRef:
                  fieldPath: metadata.annotations['admission.trusted.identity/ti-secret-key']
        - name: pod-identity
          downwardAPI:
            items:
              - path: "ti-identity"
                fieldRef:
                  fieldPath: metadata.annotations['admission.trusted.identity/ti-identity']

        - name: ti-vault-secret
          secret:
            secretName: ti-vault-
      addVolumeMounts:
        - name: ti-vault-secret
          mountPath: /vault-certs
          readOnly: true
